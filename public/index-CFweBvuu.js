(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();class m{constructor(){this.events=new Map}on(e,s){this.events.has(e)||this.events.set(e,new Set);const t=this.events.get(e);t==null||t.add(s)}once(e,s){const t=(...i)=>{s(...i),this.off(e,t)};this.on(e,t)}emit(e,...s){const t=this.events.get(e);if(!t)return;Array.from(t).forEach(n=>n(...s))}off(e,s){const t=this.events.get(e);t&&t.delete(s)}removeAllListeners(e){this.events.delete(e)}clear(){this.events.clear()}}class p{constructor(e){this._chatWindowElement=e,this.chatWindowElement=this._chatWindowElement}displayMessage(e){const s=e.render();this.chatWindowElement.appendChild(s),this.chatWindowElement.scrollTop=this.chatWindowElement.scrollHeight}}class g{respondToUser(e){return`${e}`}}class u{render(){const e=document.createElement("img");return e.src="/resources/user.svg",e.alt="User Avatar",e}}class f{render(){const e=document.createElement("img");return e.src="/resources/bot.svg",e.alt="Bot Avatar",e}}class c{static createMessage(e,s,t="text"){return new v(e,s,t)}}class v{constructor(e,s,t="text"){this.sender=e,this.content=s,this.type=t,this.avatar=this.sender==="User"?new u:new f}render(){const e=document.createElement("div");e.classList.add("message-container"),e.classList.add(`${this.sender==="User"?"sent":"received"}`);const s=document.createElement("div");s.classList.add("message-avatar"),s.appendChild(this.avatar.render());const t=document.createElement("div");if(t.classList.add("message-content"),this.type==="text"){const i=document.createElement("div");i.classList.add(`message-${this.sender==="User"?"sender":"bot"}`),i.textContent=this.content,t.appendChild(i)}else if(this.type==="image"){const i=document.createElement("img");i.src=this.content,i.alt="Sent Image",i.style.maxWidth="100%",t.appendChild(i)}return this.sender==="User"?(e.appendChild(t),e.appendChild(s)):(e.appendChild(s),e.appendChild(t)),e}}class l{constructor(e){this.message=e}render(){return this.message.render()}}const r={TEXT_SENT:"TEXT_SENT",IMAGES_SENT:"IMAGES_SENT",BOT_REPLY:"BOT_REPLY"};class x{constructor(e,s,t){this.eventEmitter=e,this.chatWindow=s,this.botService=t}init(){this.eventEmitter.on(r.TEXT_SENT,this.handleMessageSent.bind(this)),this.eventEmitter.on(r.IMAGES_SENT,this.handleImagesSent.bind(this))}handleMessageSent(e){const s=c.createMessage("User",e,"text");this.chatWindow.displayMessage(new l(s));const t=this.botService.respondToUser(e),i=c.createMessage("Bot",t,"text");this.chatWindow.displayMessage(new l(i)),this.scrollToBottom(),this.eventEmitter.emit(r.BOT_REPLY,t)}handleImagesSent(e){const s=c.createMessage("User",e,"image");this.chatWindow.displayMessage(new l(s));const t=this.botService.respondToUser(e),i=c.createMessage("Bot",t,"image");this.chatWindow.displayMessage(new l(i)),this.scrollToBottom(),this.eventEmitter.emit(r.BOT_REPLY,t)}scrollToBottom(){const e=document.getElementById("chat-window");e&&(e.scrollTop=e.scrollHeight)}}class w{constructor(e,s,t){this.inputElement=e,this.sendButton=s,this.fileInput=t,this.isSending=!1,this.onSendText=()=>{},this.onSendImage=()=>{},this.initEventListeners()}initEventListeners(){this.sendButton.removeEventListener("click",this.handleSend),this.sendButton.addEventListener("click",e=>this.handleSend(e)),this.inputElement.removeEventListener("keydown",this.handleSend),this.inputElement.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),this.handleSend(e))})}async handleSend(e){var t;if(this.isSending)return;this.isSending=!0;const s=(t=this.fileInput.files)==null?void 0:t[0];if(s)try{const i=await this.readFileAsBase64(s);this.onSendImage(i)}catch(i){console.error("Error reading file:",i)}else{const i=this.inputElement.value.trim();i&&this.onSendText(i)}setTimeout(()=>{this.clearInput(),this.isSending=!1},500)}readFileAsBase64(e){return new Promise((s,t)=>{const i=new FileReader;i.onload=()=>{i.result?s(i.result):t("FileReader result is null")},i.onerror=n=>{t(n)},i.readAsDataURL(e)})}clearInput(){this.inputElement.value=""}}class y{constructor(e,s){this.chatcontainer=e,this.header=s,this.isMinimized=!1,this.title="Welcome to APT ChatBot"}render(){this.header&&(this.header.textContent=this.title,this.header.addEventListener("click",()=>{this.toggleChatWindow()}))}toggleChatWindow(){this.isMinimized=!this.isMinimized,this.isMinimized?(this.chatcontainer.classList.add("minimized"),this.header.textContent="Open APT ChatBot"):(this.chatcontainer.classList.remove("minimized"),this.header.textContent=this.title)}}class b{constructor(e){this._iframe=e,this.iframe=this._iframe,this.eventEmitter=new m,this.chatWindow=new p(this.iframe.getElementById("chat-window")),this.chatInput=new w(this.iframe.getElementById("chat-input"),this.iframe.getElementById("chat-send"),this.iframe.getElementById("file-input")),this.botService=new g,this.chatService=new x(this.eventEmitter,this.chatWindow,this.botService)}init(){this.renderHeader(),this.chatService.init(),this.chatInput.onSendText=this.handleSendTextMessage.bind(this),this.chatInput.onSendImage=this.handleSendImageMessage.bind(this)}renderHeader(){new y(this.iframe.getElementById("chat-container"),this.iframe.getElementById("chat-header")).render()}handleSendTextMessage(e){this.eventEmitter.emit(r.TEXT_SENT,e)}handleSendImageMessage(e){this.eventEmitter.emit(r.IMAGES_SENT,e)}}const h={body:{margin:0,fontFamily:"Arial, sans-serif",display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",overflow:"hidden",padding:"2px"},".chat-container":{display:"flex",flexDirection:"column",width:"100%",maxWidth:"400px",height:"100%",borderRadius:"12px",backgroundColor:"white",overflow:"hidden",position:"relative",border:"1px solid #ddd",bottom:"5px"},".chat-header":{textAlign:"center",fontWeight:"bold",fontSize:"16px",backgroundColor:"#007BFF",color:"white",padding:"15px",position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",bottom:"0"},".chat-container.minimized":{bottom:"0",height:"45px",overflow:"hidden",marginTop:"450px",width:"200px"},".close-chat-btn":{background:"none",border:"none",color:"white",fontSize:"18px",cursor:"pointer"},".chat-window":{flex:1,padding:"15px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"10px",height:"calc(100% - 140px)"},".message-container":{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px",borderRadius:"10px",padding:"10px"},".message-bot":{maxWidth:"75%",padding:"12px 16px",borderRadius:"10px",fontSize:"14px",lineHeight:"1.5",border:"1px solid #ddd",backgroundColor:"skyblue",wordWrap:"break-word",overflowWrap:"anywhere",whiteSpace:"normal",overflow:"hidden"},".message-sender":{maxWidth:"75%",padding:"12px 16px",borderRadius:"10px",fontSize:"14px",lineHeight:"1.5",border:"1px solid #ddd",backgroundColor:"antiquewhite",wordWrap:"break-word",overflowWrap:"anywhere",whiteSpace:"normal",overflow:"hidden"},".message.sent":{backgroundColor:"#007BFF",color:"white",alignSelf:"flex-end",borderColor:"#0056b3",justifyContent:"flex-end"},".message.received":{backgroundColor:"#f0f0f0",color:"#333",alignSelf:"flex-start",borderColor:"#ccc",justifyContent:"flex-start"},".message-avatar":{width:"40px",height:"40px",borderRadius:"50%",overflow:"hidden"},".user-avatar":{marginLeft:"auto"},".bot-avatar":{marginRight:"auto"},".message-avatar img":{width:"100%",height:"100%",objectFit:"cover"},".message-content":{flex:1},".chat-input-container":{display:"flex",alignItems:"center",padding:"10px",borderTop:"1px solid #ddd"},'.chat-input-container input[type="text"]':{flex:1,padding:"10px",borderRadius:"12px",border:"1px solid #ccc",outline:"none",marginRight:"15px",fontSize:"16px",backgroundColor:"#f9f9f9",transition:"all 0.3s ease"},'.chat-input-container input[type="text"]:focus':{borderColor:"#007BFF",boxShadow:"0 0 10px rgba(0, 123, 255, 0.5)"},".chat-input-container button":{padding:"10px",backgroundColor:"#007BFF",color:"white",border:"none",borderRadius:"35%",fontSize:"16px",cursor:"pointer"},".chat-input-container .file-upload":{color:"#007BFF",fontSize:"18px",cursor:"pointer",marginRight:"15px"},".message-content img":{maxWidth:"100%",maxHeight:"300px",borderRadius:"12px",objectFit:"cover",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",marginTop:"10px",marginBottom:"10px",border:"1px solid #ccc"}};class o{constructor(){}static getInstance(){return o.instance||(o.instance=new o),o.instance}appendIframeToBody(){this.iframe||(this.iframe=document.createElement("iframe"),this.iframe.style.width="325px",this.iframe.style.height="500px",this.iframe.style.border="none",this.iframe.style.position="fixed",this.iframe.style.bottom="20px",this.iframe.style.right="20px",this.iframe.style.zIndex="1000",this.iframe.id="apt-92",document.body.appendChild(this.iframe))}initialize(e){if(this.iframe){const s=this.getIframeDocument();s&&(s.body.innerHTML=e,h&&typeof h=="object"&&this.applyStyles(s))}}applyStyles(e){const s=this.toStyleSheetString(h),t=e.createElement("style");t.type="text/css",t.id="apt-92-styles",t.innerHTML=s,e.head.appendChild(t)}toStyleSheetString(e){let s="";for(const t in e){let i="";for(const n in e[t]){const d=n.replace(/([A-Z])/g,"-$1").toLowerCase();i+=`${d}: ${e[t][n]};
`}s+=`${t} {
${i}}
`}return s}getIframeDocument(){var e;return this.iframe.contentDocument||((e=this.iframe.contentWindow)==null?void 0:e.document)||null}addResizeEventListener(){}}(function(){const a=o.getInstance();a.appendIframeToBody(),a.initialize(E());const e=a.getIframeDocument();e&&new b(e).init()})();function E(){return`
        <div class="chat-container" id="chat-container">
            <div class="chat-header" id="chat-header"></div>
            <div class="chat-window" id="chat-window">
                <div class="message-container received">
                    <div class="message-avatar bot-avatar">
                        <img src="/resources/bot.svg" alt="Bot Avatar">
                    </div>
                    <div class="message-content">
                        <div class="message-bot">Hello! How can I help you?</div>
                    </div>
                </div>

                <div class="message-container sent">
                    <div class="message-content">
                        <div class="message-sender">I have a question about my order.</div>
                    </div>
                    <div class="message-avatar user-avatar">
                        <img src="/resources/user.svg" alt="User Avatar">
                    </div>
                </div>
            </div>
            <div class="chat-input-container">
                <label class="file-upload" for="file-input">📎</label>
                <input type="file" id="file-input" accept="image/*" style="display: none;">
                <input type="text" placeholder="Enter your message..." id="chat-input">
                <button id="chat-send">➤</button>
            </div>
        </div>
    `}
